(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{34:function(t,y,l){t.exports=l(63)},46:function(t,y,l){},48:function(t,y,l){},56:function(t,y,l){},58:function(t,y,l){},61:function(t,y,l){},63:function(t,y,l){function P(z,p,c){var d=new XMLHttpRequest;d.open("GET",z);d.overrideMimeType("text/plain; charset=x-user-defined");d.onload=function(){200===this.status?p(null,this.responseText):0!==this.status&&p(Error(d.statusText))};d.onerror=function(){p(Error(d.statusText))};d.onprogress=c;d.send();
return d}l.r(y);t=l(14);var J=l.n(t);t=l(1);var f=l.n(t);y=l(15);var Q=l.n(y),A=l(4),C=l(6),G=l(9),H=l(8),I=l(10);l(64);var R=l(66),K=l(67);l(46);var B=l(7),L=l(65),M={"\u8d85\u7ea7\u739b\u4e3d":"roms/classic/mario.nes","\u8d85\u7ea7\u739b\u4e3d(\u65e0\u654c\u7248)":"roms/haker/mario.nes","\u8d85\u7ea7\u739b\u4e3d2(\u7f8e\u7248)":"roms/nes/Super%20Mario%20Bros%202%20(Rev%201)%20(U).nes","\u8d85\u7ea7\u739b\u4e3d3":"roms/nes/Super%20Mario%20Bros%203%20(Rev%201)%20(U).nes",
"\u5766\u514b\u5927\u6218":"roms/classic/tank.nes","\u5766\u514b\u5927\u6218(\u65e0\u8001\u7a9d\u7248)":"roms/haker/tank.nes","\u5766\u514b\u5927\u6218(\u70df\u5c71\u7248)":"roms/classic/90tank.nes","\u6210\u9f99\u8e22\u9986":"roms/classic/jackieChan.nes","\u529f\u592b\u5c0f\u5b50":"roms/classic/kongfu.nes","\u9a6c\u620f\u56e2":"roms/classic/maxituan.nes","\u5feb\u6253\u65cb\u98ce":"roms/classic/kuaidaxuanfeng.nes","\u9b42\u6597\u7f57(\u7f8e\u7248)":"roms/classic/hundouluo.nes","\u9b42\u6597\u7f57(S\u67aa30\u6761\u547d)":"roms/haker/hundouluo_30.nes",
1942:"roms/classic/1942.nes",1943:"roms/classic/1943.nes","\u897f\u6e38\u8bb0":"roms/classic/xiyouji.nes","\u897f\u6e38\u8bb0(\u65e0\u654c\u7248)":"roms/haker/xiyouji.nes","\u5403\u8c46\u4eba":"roms/classic/chidouren.nes","F1\u8d5b\u8f66":"roms/classic/f1.nes","FC\u539f\u4eba":"roms/classic/fcyuanren.nes","93\u8d85\u7ea7\u9b42(\u9b42\u6597\u7f57\u6c34\u4e0b\u516b\u5173)":"roms/classic/hdlchina.nes","\u53cc\u622a\u9f991":"roms/classic/shuangjielong1.nes","\u5fcd\u8005\u9f99\u5251\u4f201":"roms/classic/renzhelong1.nes",
"\u6c99\u7f57\u66fc\u86c7":"roms/classic/shaluomanshe.nes","\u8d8a\u91ce\u6469\u6258":"roms/classic/motor.nes","\u732b\u548c\u8001\u9f20":"roms/classic/tom.nes","\u5154\u5b9d\u5b9d\u5386\u9669\u8bb0(\u7f8e\u7248)":"roms/classic/rabit.nes","\u70b8\u5f39\u4eba\u6770\u514b":"roms/classic/jack.nes","\u5fcd\u8005\u795e\u9f9f\u2160":"roms/classic/turtles.nes","\u5fcd\u8005\u795e\u9f9f\u2160 (\u65e0\u654c\u7248)":"roms/haker/turtles.nes","\u5c0f\u6cf0\u5c71(\u65e0\u654c\u7248)":"roms/haker/xiaotaishan.nes",
"\u5fcd\u8005\u9f99\u5251\u4f201(\u65e0\u654c\u7248)":"roms/haker/renzhelong1.nes","win98\u5b66\u4e60\u5361":"roms/others/win98.nes","\u5f71\u5b50\u4f20\u8bf4":"roms/classic/shadow.nes","\u5f71\u5b50\u4f20\u8bf4(\u65e0\u654c\u7248)":"roms/haker/shadow.nes","\u5965\u8fd0\u4f1a":"roms/classic/olympic.nes","Bubble Bobble":"roms/nes/Bubble%20Bobble%20(U).nes",Castlevania:"roms/nes/Castlevania%20(E).nes",
Contra:"roms/nes/Contra%20(U).nes","Donkey Kong Classics":"roms/nes/Donkey%20Kong%20Classics%20(U).nes","Duck Hunt":"roms/nes/Duck%20Hunt%20(JUE).nes","Final Fantasy":"roms/nes/Final%20Fantasy%20(U).nes",Golf:"roms/nes/Golf%20(JU).nes",
"Kirby's Adventure":"roms/nes/Kirby's%20Adventure%20(U).nes","The Legend of Zelda":"roms/nes/Legend%20of%20Zelda,%20The%20(Rev%201)%20(U).nes",Lemmings:"roms/nes/Lemmings%20(U).nes",Lifeforce:"roms/nes/Lifeforce%20(U).nes",
"Mega Man":"roms/nes/Mega%20Man%20(U).nes","Metal Gear":"roms/nes/Metal%20Gear%20(U).nes",Metroid:"roms/nes/Metroid%20(U).nes","Pac-Man":"roms/nes/Pac-Man%20(U).nes","Tecmo Super Bowl":"roms/nes/Tecmo%20Super%20Bowl%20(U).nes",
"Teenage Mutant Ninja Turtles II":"roms/nes/Teenage%20Mutant%20Ninja%20Turtles%202%20(U).nes",Tennis:"roms/nes/Tennis%20(JU).nes",Tetris:"roms/nes/Tetris%20(U).nes","Tetris 2":"roms/nes/Tetris%202%20(U).nes",
"Zelda 2":"roms/nes/Zelda%202%20-%20The%20Adventure%20of%20Link%20(U).nes"};y=Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_SENTRY_URI;var S=function(z){function p(){var c;Object(A.a)(this,p);for(var d=arguments.length,a=Array(d),b=0;b<d;b++)a[b]=arguments[b];var e=Object(G.a)(this,(c=Object(H.a)(p)).call.apply(c,[this].concat(a)));e.handleDragOver=function(h){h.preventDefault();h.dataTransfer.dropEffect="copy"};e.handleDrop=
function(h){h.preventDefault();h=h.dataTransfer.items?h.dataTransfer.items[0].getAsFile():h.dataTransfer.files[0];e.props.history.push({pathname:"/run",state:{file:h}})};return e}Object(I.a)(p,z);Object(C.a)(p,[{key:"render",value:function(){return f.a.createElement("div",{className:"container ListPage my-4",onDragOver:this.handleDragOver,onDrop:this.handleDrop},f.a.createElement("div",{className:"row justify-content-center"},f.a.createElement("div",{className:"col-md-8"},f.a.createElement("header",
{className:"mb-4"},f.a.createElement("h1",{className:"mb-3"},"FC \u6e38\u620f\u5728\u7ebf\u73a9"),f.a.createElement(B.b,{className:"mb-4"},Object.keys(M).map(function(c){return f.a.createElement(L.a,{key:c,to:"/run/"+encodeURIComponent(c),className:"list-group-item"},c,f.a.createElement("span",{className:"float-right"},"\u203a"))})),f.a.createElement("p",null,"\u6ca1\u627e\u5230\u559c\u6b22\u7684\u6e38\u620f\uff1f\u76f4\u63a5\u5c06\u6e38\u620f NES ROM \u62d6\u52a8\u5230\u672c\u9875\u9762\u5373\u53ef\u5728\u7ebf\u8fd0\u884c"),
f.a.createElement("p",null,"By ",f.a.createElement("a",{href:"https://twitter.com/bfirsh"},"Ben Firshman"),".")))))}}]);return p}(t.Component);l(48);var T=l(17),U=l(33),V=l(30),D=l(11),m=l(3),E=function(z){function p(c){Object(A.a)(this,p);c=Object(G.a)(this,Object(H.a)(p).call(this,c));c.state={playerOneButton:"",playerTwoButton:"",waitingForKey:0};c.handleClick=c.handleClick.bind(Object(D.a)(Object(D.a)(c)));return c}Object(I.a)(p,z);Object(C.a)(p,[{key:"componentDidMount",value:function(){var c=
this.props.keys,d=this.props.button,a=[],b;for(b in c)1===c[b][0]&&c[b][1]===d?(a[0]=c[b][2],console.log(a[0])):2===c[b][0]&&c[b][1]===d&&(a[1]=c[b][2]);this.setState({playerOneButton:a[0],playerTwoButton:a[1]})}},{key:"componentDidUpdate",value:function(c,d){var a=this.props.keys,b=this.props.button,e=[];for(k in a)1===a[k][0]&&a[k][1]===b?(e[0]=a[k][2],console.log(e[0])):2===a[k][0]&&a[k][1]===b&&(e[1]=a[k][2]);var h=function(u,v){return u.buttons.filter(function(w){return w.buttonId===v})[0]},
g=function(u,v){return v.buttons.filter(function(w){return!u||!u.buttons.some(function(F){return F.buttonId===w.buttonId})})[0]};var k=a=0;var r=function(u){if("button"===u.type)return"Btn-"+u.code;if("axis"===u.type)return"Axis-"+u.code+" "+u.value};if(this.props.gamepadConfig&&this.props.gamepadConfig.playerGamepadId){var q=this.props.gamepadConfig.playerGamepadId;if(q[0]){e[0]="";var n=h(this.props.gamepadConfig.configs[q[0]],b);var x=g(c.gamepadConfig.configs[q[0]],this.props.gamepadConfig.configs[q[0]]);
n?e[0]=r(n):x&&x.buttonId===this.props.prevButton&&!a&&(k=a=1)}q[1]&&(e[1]="",n=h(this.props.gamepadConfig.configs[q[1]],b),x=g(c.gamepadConfig.configs[q[1]],this.props.gamepadConfig.configs[q[1]]),n?e[1]=r(n):x&&x.buttonId===this.props.prevButton&&!a&&(k=a=2))}c={};a&&this.props.handleClick([k,this.props.button]);if(d.playerOneButton!==e[0]||d.playerTwoButton!==e[1])c.playerOneButton=e[0],c.playerTwoButton=e[1];a?c.waitingForKey=a:1===d.waitingForKey?this.props.currentPromptButton!==this.props.button&&
(c.waitingForKey=0):2===d.waitingForKey&&this.props.currentPromptButton!==this.props.button&&(c.waitingForKey=0);0<Object.keys(c).length&&this.setState(c)}},{key:"handleClick",value:function(c){this.props.handleClick([c,this.props.button]);this.setState({waitingForKey:c})}},{key:"render",value:function(){var c=this;return f.a.createElement("tr",null,f.a.createElement("td",null,this.props.buttonName),f.a.createElement("td",{onClick:function(){return c.handleClick(1)}},1===this.state.waitingForKey?
"\u6309\u4e0b\u952e\u76d8\u8fdb\u884c\u8bbe\u7f6e...":this.state.playerOneButton),f.a.createElement("td",{onClick:function(){return c.handleClick(2)}},2===this.state.waitingForKey?"\u6309\u4e0b\u952e\u76d8\u8fdb\u884c\u8bbe\u7f6e...":this.state.playerTwoButton))}}]);return p}(t.Component),W=function(z){function p(c){Object(A.a)(this,p);var d=Object(G.a)(this,Object(H.a)(p).call(this,c));d.state={gamepadConfig:c.gamepadConfig,keys:c.keys,button:void 0,modified:!1};d.handleKeyDown=d.handleKeyDown.bind(Object(D.a)(Object(D.a)(d)));
d.handleGamepadButtonDown=d.handleGamepadButtonDown.bind(Object(D.a)(Object(D.a)(d)));d.listenForKey=d.listenForKey.bind(Object(D.a)(Object(D.a)(d)));d.state.gamepadConfig=d.state.gamepadConfig||{};d.state.gamepadConfig.playerGamepadId=d.state.gamepadConfig.playerGamepadId||[null,null];d.state.gamepadConfig.configs=d.state.gamepadConfig.configs||{};d.state.controllerIcon=d.state.gamepadConfig.playerGamepadId.map(function(a){return a?"img/nes_controller.png":"img/keyboard.png"});d.state.controllerIconAlt=
d.state.gamepadConfig.playerGamepadId.map(function(a){return a?"gamepad":"keyboard"});d.state.currentPromptButton=-1;return d}Object(I.a)(p,z);Object(C.a)(p,[{key:"componentWillUnmount",value:function(){this.state.modified&&(this.props.setKeys(this.state.keys),this.props.setGamepadConfig(this.state.gamepadConfig));this.removeKeyListener()}},{key:"listenForKey",value:function(c){var d=c[1];this.removeKeyListener();this.setState({button:c,currentPromptButton:d});this.props.promptButton(this.handleGamepadButtonDown);
document.addEventListener("keydown",this.handleKeyDown)}},{key:"handleGamepadButtonDown",value:function(c){this.removeKeyListener();var d=this.state.button,a=d[0],b=d[1],e=c.gamepadId,h=this.state.gamepadConfig;d=h.playerGamepadId.slice(0);var g={};d[a-1]=e;c={code:c.code,type:c.type,buttonId:b,value:c.value};g[e]={buttons:(h.configs[e]||{buttons:[]}).buttons.filter(function(k){return k.buttonId!==b}).concat([c])};c=Object.assign({},h.configs,g);this.setState({gamepadConfig:{configs:c,playerGamepadId:d},
currentPromptButton:-1,controllerIcon:d.map(function(k){return k?"img/nes_controller.png":"img/keyboard.png"}),modified:!0})}},{key:"handleKeyDown",value:function(c){this.removeKeyListener();var d=this.state.button,a=this.state.keys,b={},e;for(e in a)if(a[e][0]!==d[0]||a[e][1]!==d[1])b[e]=a[e];a=this.state.gamepadConfig.playerGamepadId.slice(0);a[d[0]-1]=null;this.setState({keys:Object(V.a)({},b,Object(T.a)({},c.keyCode,Object(U.a)(d.slice(0,2)).concat([1<c.key.length?c.key:String(c.key).toUpperCase()]))),
button:void 0,gamepadConfig:{configs:this.state.gamepadConfig.configs,playerGamepadId:a},currentPromptButton:-1,controllerIcon:a.map(function(h){return h?"img/nes_controller.png":"img/keyboard.png"}),controllerIconAlt:a.map(function(h){return h?"gamepad":"keyboard"}),modified:!0})}},{key:"removeKeyListener",value:function(){this.props.promptButton(null);document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return f.a.createElement(B.c,{isOpen:this.props.isOpen,
toggle:this.props.toggle,className:"ControlsModal"},f.a.createElement(B.f,{toggle:this.props.toggle},"\u952e\u76d8\u8bbe\u7f6e"),f.a.createElement(B.d,null,f.a.createElement(B.h,null,f.a.createElement("thead",null,f.a.createElement("tr",null,f.a.createElement("th",null,"\u6309\u952e"),f.a.createElement("th",null,"\u73a9\u5bb6\u4e00",f.a.createElement("img",{className:"controller-icon",src:this.state.controllerIcon[0],alt:this.state.controllerIconAlt[0]})),f.a.createElement("th",null,"\u73a9\u5bb6\u4e8c",
f.a.createElement("img",{className:"controller-icon",src:this.state.controllerIcon[1],alt:this.state.controllerIconAlt[1]})))),f.a.createElement("tbody",null,f.a.createElement(E,{buttonName:"\u2190",currentPromptButton:this.state.currentPromptButton,button:m.Controller.BUTTON_LEFT,prevButton:m.Controller.BUTTON_SELECT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),f.a.createElement(E,{buttonName:"\u2192",currentPromptButton:this.state.currentPromptButton,
button:m.Controller.BUTTON_RIGHT,prevButton:m.Controller.BUTTON_LEFT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),f.a.createElement(E,{buttonName:"\u2191",currentPromptButton:this.state.currentPromptButton,button:m.Controller.BUTTON_UP,prevButton:m.Controller.BUTTON_RIGHT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),f.a.createElement(E,{buttonName:"\u2193",currentPromptButton:this.state.currentPromptButton,
button:m.Controller.BUTTON_DOWN,prevButton:m.Controller.BUTTON_UP,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),f.a.createElement(E,{buttonName:"A",currentPromptButton:this.state.currentPromptButton,button:m.Controller.BUTTON_A,prevButton:m.Controller.BUTTON_DOWN,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),f.a.createElement(E,{buttonName:"B",currentPromptButton:this.state.currentPromptButton,button:m.Controller.BUTTON_B,
prevButton:m.Controller.BUTTON_A,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),f.a.createElement(E,{buttonName:"\u5f00\u59cb",currentPromptButton:this.state.currentPromptButton,button:m.Controller.BUTTON_START,prevButton:m.Controller.BUTTON_B,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),f.a.createElement(E,{buttonName:"\u5207\u6362",currentPromptButton:this.state.currentPromptButton,button:m.Controller.BUTTON_SELECT,
prevButton:m.Controller.BUTTON_START,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig})))),f.a.createElement(B.e,null,f.a.createElement(B.a,{outline:!0,color:"primary",onClick:this.props.toggle},"\u5173\u95ed")))}}]);return p}(t.Component),X=function(){function z(p){var c=this;Object(A.a)(this,z);this.onAnimationFrame=function(){if(c.calibrating&&(null===c.calibrationStartTime?(c.calibrationStartTime=(new Date).getTime(),c.calibrationCurrentFrames=0):c.calibrationCurrentFrames+=
1,c.calibrationCurrentFrames===c.calibrationFrames)){c.calibrating=!1;var d=1E3/(((new Date).getTime()-c.calibrationStartTime)/c.calibrationFrames);if(d<=c.desiredFPS-c.calibrationTolerance||d>=c.desiredFPS+c.calibrationTolerance)console.log("Enabling bodge mode. (Desired FPS is ".concat(c.desiredFPS,", actual FPS is ").concat(d,")")),c.startBodgeMode()}c.requestAnimationFrame();if(c.running){if(!c.bodgeMode)c.onGenerateFrame();c.onWriteFrame()}};this.startBodgeMode=function(){c.bodgeMode=!0;c.bodgeInterval=
setInterval(c.onBodge,1E3/c.desiredFPS)};this.onBodge=function(){if(c.running)c.onGenerateFrame()};this.onGenerateFrame=p.onGenerateFrame;this.onWriteFrame=p.onWriteFrame;this.bodgeMode=this.running=!1;this.desiredFPS=60;this.calibrationDelay=200;this.calibrationFrames=10;this.calibrationTolerance=5;this.calibrating=!1;this.calibrationCurrentFrames=this.calibrationStartTime=null}Object(C.a)(z,[{key:"start",value:function(){this.running=!0;this.requestAnimationFrame();this.bodgeMode&&this.startBodgeMode()}},
{key:"stop",value:function(){this.running=!1;this._requestID&&window.cancelAnimationFrame(this._requestID);this.bodgeInterval&&clearInterval(this.bodgeInterval)}},{key:"requestAnimationFrame",value:function(){this._requestID=window.requestAnimationFrame(this.onAnimationFrame)}}]);return z}(),Y={75:[1,m.Controller.BUTTON_A,"K"],74:[1,m.Controller.BUTTON_B,"J"],70:[1,m.Controller.BUTTON_SELECT,"F"],72:[1,m.Controller.BUTTON_START,"H"],87:[1,m.Controller.BUTTON_UP,"W"],83:[1,m.Controller.BUTTON_DOWN,
"S"],65:[1,m.Controller.BUTTON_LEFT,"A"],68:[1,m.Controller.BUTTON_RIGHT,"D"],13:[2,m.Controller.BUTTON_A,"Enter"],99:[2,m.Controller.BUTTON_B,"3"],97:[2,m.Controller.BUTTON_SELECT,"1"],98:[2,m.Controller.BUTTON_START,"2"],38:[2,m.Controller.BUTTON_UP,"\u2191"],40:[2,m.Controller.BUTTON_DOWN,"\u2193"],37:[2,m.Controller.BUTTON_LEFT,"\u2190"],39:[2,m.Controller.BUTTON_RIGHT,"\u2192"]},Z=function c(p){var d=this;Object(A.a)(this,c);this.loadKeys=function(){var a;try{(a=localStorage.getItem("keys"))&&
(a=JSON.parse(a))}catch(b){console.log("Failed to get keys from localStorage.",b)}d.keys=a||Y};this.setKeys=function(a){try{localStorage.setItem("keys",JSON.stringify(a)),d.keys=a}catch(b){console.log("Failed to set keys in localStorage")}};this.handleKeyDown=function(a){var b=d.keys[a.keyCode];b&&(d.onButtonDown(b[0],b[1]),a.preventDefault())};this.handleKeyUp=function(a){var b=d.keys[a.keyCode];b&&(d.onButtonUp(b[0],b[1]),a.preventDefault())};this.handleKeyPress=function(a){a.preventDefault()};
this.onButtonDown=p.onButtonDown;this.onButtonUp=p.onButtonUp},ba=function d(c){var a=this;Object(A.a)(this,d);this.disableIfGamepadEnabled=function(b){return function(e,h){if(!a.gamepadConfig)return b(e,h);var g=a.gamepadConfig.playerGamepadId;if(!g||!g[e-1])return b(e,h)}};this._getPlayerNumberFromGamepad=function(b){return a.gamepadConfig.playerGamepadId[0]===b.id?1:a.gamepadConfig.playerGamepadId[1]===b.id?2:1};this.poll=function(){for(var b=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads(),
e=[],h=0;h<b.length;h++){var g=b[h],k=a.gamepadState[h];if(g)if(k){var r=g.buttons,q=k.buttons;if(a.buttonCallback){for(var n=0;n<g.axes.length;n++){var x=g.axes[n],u=k.axes[n];-1===x&&-1!==u&&a.buttonCallback({gamepadId:g.id,type:"axis",code:n,value:x});1===x&&1!==u&&a.buttonCallback({gamepadId:g.id,type:"axis",code:n,value:x})}for(k=0;k<r.length;k++)n=q[k],r[k].pressed&&!n.pressed&&a.buttonCallback({gamepadId:g.id,type:"button",code:k})}else if(a.gamepadConfig&&(n=a._getPlayerNumberFromGamepad(g),
2>e.length&&(-1!==e.indexOf(n)&&(n++,2<n&&(n=1)),e.push(n),a.gamepadConfig.configs[g.id])))for(x=a.gamepadConfig.configs[g.id].buttons,u=0;u<x.length;u++){var v=x[u];if("button"===v.type){var w=v.code,F=r[w];w=q[w];if(F.pressed&&!w.pressed)a.onButtonDown(n,v.buttonId);else if(!F.pressed&&w.pressed)a.onButtonUp(n,v.buttonId)}else if("axis"===v.type){w=v.code;F=g.axes[w];w=k.axes[w];if(F===v.value&&w!==v.value)a.onButtonDown(n,v.buttonId);if(F!==v.value&&w===v.value)a.onButtonUp(n,v.buttonId)}}a.gamepadState[h]=
{buttons:r.map(function(aa){return{pressed:aa.pressed}}),axes:g.axes.slice(0)}}else a.gamepadState[h]=g}};this.promptButton=function(b){a.buttonCallback=b?function(e){a.buttonCallback=null;b(e)}:b};this.loadGamepadConfig=function(){var b;try{(b=localStorage.getItem("gamepadConfig"))&&(b=JSON.parse(b))}catch(e){console.log("Failed to get gamepadConfig from localStorage.",e)}a.gamepadConfig=b};this.setGamepadConfig=function(b){try{localStorage.setItem("gamepadConfig",JSON.stringify(b)),a.gamepadConfig=
b}catch(e){console.log("Failed to set gamepadConfig in localStorage")}};this.startPolling=function(){var b=!1;requestAnimationFrame(function h(){b||(a.poll(),requestAnimationFrame(h))});return{stop:function(){b=!0}}};this.onButtonDown=c.onButtonDown;this.onButtonUp=c.onButtonUp;this.gamepadState=[];this.buttonCallback=null};l(56);var ca=function(c){function d(){var a;Object(A.a)(this,d);for(var b=arguments.length,e=Array(b),h=0;h<b;h++)e[h]=arguments[h];var g=Object(G.a)(this,(a=Object(H.a)(d)).call.apply(a,
[this].concat(e)));g.setBuffer=function(k){for(var r,q=0;240>q;++q)for(var n=0;256>n;++n)r=256*q+n,g.buf32[r]=4278190080|k[r]};g.writeBuffer=function(){g.imageData.data.set(g.buf8);g.context.putImageData(g.imageData,0,0)};g.fitInParent=function(){var k=g.canvas.parentNode,r=k.clientWidth;k=k.clientHeight;var q=256/240;q<r/k?(g.canvas.style.width="".concat(Math.round(k*q),"px"),g.canvas.style.height="".concat(k,"px")):(g.canvas.style.width="".concat(r,"px"),g.canvas.style.height="".concat(Math.round(r/
q),"px"))};g.handleMouseDown=function(k){if(g.props.onMouseDown){var r=256/parseFloat(g.canvas.style.width),q=g.canvas.getBoundingClientRect();g.props.onMouseDown(Math.round((k.clientX-q.left)*r),Math.round((k.clientY-q.top)*r))}};return g}Object(I.a)(d,c);Object(C.a)(d,[{key:"render",value:function(){var a=this;return f.a.createElement("canvas",{className:"Screen",width:256,height:240,onMouseDown:this.handleMouseDown,onMouseUp:this.props.onMouseUp,ref:function(b){a.canvas=b}})}},{key:"componentDidMount",
value:function(){this.initCanvas()}},{key:"componentDidUpdate",value:function(){this.initCanvas()}},{key:"initCanvas",value:function(){this.context=this.canvas.getContext("2d");this.imageData=this.context.getImageData(0,0,256,240);this.context.fillStyle="black";this.context.fillRect(0,0,256,240);this.buf=new ArrayBuffer(this.imageData.data.length);this.buf8=new Uint8ClampedArray(this.buf);this.buf32=new Uint32Array(this.buf);for(var a=0;a<this.buf32.length;++a)this.buf32[a]=4278190080}},{key:"screenshot",
value:function(){var a=new Image;a.src=this.canvas.toDataURL("image/png");return a}}]);return d}(t.Component),da=l(31),ea=l.n(da),N=function(c,d){console.error(c);J.a.captureException(c,{extra:d})},fa=function(){function c(d){var a=this;d=d.onBufferUnderrun;Object(A.a)(this,c);this.writeSample=function(b,e){a.buffer.size()/2>=a.bufferSize&&console.log("Buffer overrun");a.buffer.enq(b);a.buffer.enq(e)};this.onaudioprocess=function(b){var e=b.outputBuffer.getChannelData(0);b=b.outputBuffer.getChannelData(1);
var h=e.length;if(a.buffer.size()<2*h&&a.onBufferUnderrun)a.onBufferUnderrun(a.buffer.size(),2*h);try{var g=a.buffer.deqN(2*h)}catch(r){g=a.buffer.size()/2;0<g&&console.log("Buffer underrun (needed ".concat(h,", got ").concat(g,")"));for(g=0;g<h;g++)e[g]=0,b[g]=0;return}for(var k=0;k<h;k++)e[k]=g[2*k],b[k]=g[2*k+1]};this.onBufferUnderrun=d;this.bufferSize=8192;this.buffer=new ea.a(2*this.bufferSize)}Object(C.a)(c,[{key:"start",value:function(){window.AudioContext&&(this.audioCtx=new window.AudioContext,
this.scriptNode=this.audioCtx.createScriptProcessor(1024,0,2),this.scriptNode.onaudioprocess=this.onaudioprocess,this.scriptNode.connect(this.audioCtx.destination))}},{key:"stop",value:function(){this.scriptNode&&(this.scriptNode.disconnect(this.audioCtx.destination),this.scriptNode=this.scriptNode.onaudioprocess=null);this.audioCtx&&(this.audioCtx.close().catch(N),this.audioCtx=null)}}]);return c}(),O=function(c){function d(a){Object(A.a)(this,d);var b=Object(G.a)(this,Object(H.a)(d).call(this,a));
b.load=function(){if(b.props.match.params.rom){var e=b.props.match.params.rom,h=M[e];h?b.currentRequest=P(h,function(g,k){g?window.alert("Error loading ROM: ".concat(g.toString())):b.handleLoaded(k)},b.handleProgress):b.setState({error:"No such ROM: ".concat(e)})}else b.props.location.state&&b.props.location.state.file?(e=new FileReader,e.readAsBinaryString(b.props.location.state.file),e.onload=function(g){b.currentRequest=null;b.handleLoaded(g.target.result)}):window.alert("No ROM provided")};b.handleProgress=
function(e){e.lengthComputable&&b.setState({loadedPercent:e.loaded/e.total*100})};b.handleLoaded=function(e){b.setState({uiEnabled:!0,running:!0,loading:!1});b.nes.loadROM(e);b.start()};b.start=function(){b.frameTimer.start();b.speakers.start();b.fpsInterval=setInterval(function(){console.log("FPS: ".concat(b.nes.getFPS()))},1E3)};b.stop=function(){b.frameTimer.stop();b.speakers.stop();clearInterval(b.fpsInterval)};b.handlePauseResume=function(){b.state.paused?(b.setState({paused:!1}),b.start()):
(b.setState({paused:!0}),b.stop())};b.layout=function(){var e=parseFloat(window.getComputedStyle(b.navbar).height);b.screenContainer.style.height="".concat(window.innerHeight-e,"px");b.screen.fitInParent()};b.toggleControlsModal=function(){b.setState({controlsModal:!b.state.controlsModal})};b.state={running:!1,paused:!1,controlsModal:!1,loading:!0,loadedPercent:3,error:null};return b}Object(I.a)(d,c);Object(C.a)(d,[{key:"render",value:function(){var a=this;return f.a.createElement("div",{className:"RunPage"},
f.a.createElement("nav",{className:"navbar navbar-expand",ref:function(b){a.navbar=b}},f.a.createElement("ul",{className:"navbar-nav mr-auto"},f.a.createElement("li",{className:"navitem"},f.a.createElement(L.a,{to:"/",className:"nav-link"},"\u2039 \u8fd4\u56de"))),f.a.createElement(B.a,{outline:!0,color:"primary",onClick:this.toggleControlsModal,className:"mr-3"},"\u952e\u76d8\u8bbe\u7f6e"),f.a.createElement(B.a,{outline:!0,color:"primary",onClick:this.handlePauseResume,disabled:!this.state.running},
this.state.paused?"\u6062\u590d":"\u6682\u505c")),this.state.error?this.state.error:f.a.createElement("div",{className:"screen-container",ref:function(b){a.screenContainer=b}},this.state.loading?f.a.createElement(B.g,{value:this.state.loadedPercent,style:{position:"absolute",width:"70%",left:"15%",top:"48%"}}):null,f.a.createElement(ca,{ref:function(b){a.screen=b},onGenerateFrame:function(){a.nes.frame()},onMouseDown:function(b,e){a.nes.zapperMove(b,e);a.nes.zapperFireDown()},onMouseUp:function(){a.nes.zapperFireUp()}}),
this.state.controlsModal&&f.a.createElement(W,{isOpen:this.state.controlsModal,toggle:this.toggleControlsModal,keys:this.keyboardController.keys,setKeys:this.keyboardController.setKeys,promptButton:this.gamepadController.promptButton,gamepadConfig:this.gamepadController.gamepadConfig,setGamepadConfig:this.gamepadController.setGamepadConfig})))}},{key:"componentDidMount",value:function(){var a=this;this.speakers=new fa({onBufferUnderrun:function(b,e){a.state.running&&!a.state.paused&&(console.log("Buffer underrun, running another frame to try and catch up"),
a.nes.frame(),a.speakers.buffer.size()<e&&(console.log("Still buffer underrun, running a second frame"),a.nes.frame()))}});this.nes=new m.NES({onFrame:this.screen.setBuffer,onStatusUpdate:console.log,onAudioSample:this.speakers.writeSample});window.nes=this.nes;this.frameTimer=new X({onGenerateFrame:J.a.wrap(this.nes.frame),onWriteFrame:J.a.wrap(this.screen.writeBuffer)});this.gamepadController=new ba({onButtonDown:this.nes.buttonDown,onButtonUp:this.nes.buttonUp});this.gamepadController.loadGamepadConfig();
this.gamepadPolling=this.gamepadController.startPolling();this.keyboardController=new Z({onButtonDown:this.gamepadController.disableIfGamepadEnabled(this.nes.buttonDown),onButtonUp:this.gamepadController.disableIfGamepadEnabled(this.nes.buttonUp)});this.keyboardController.loadKeys();document.addEventListener("keydown",this.keyboardController.handleKeyDown);document.addEventListener("keyup",this.keyboardController.handleKeyUp);document.addEventListener("keypress",this.keyboardController.handleKeyPress);
window.addEventListener("resize",this.layout);this.layout();this.load()}},{key:"componentWillUnmount",value:function(){this.currentRequest&&this.currentRequest.abort();this.stop();document.removeEventListener("keydown",this.keyboardController.handleKeyDown);document.removeEventListener("keyup",this.keyboardController.handleKeyUp);document.removeEventListener("keypress",this.keyboardController.handleKeyPress);this.gamepadPolling.stop();window.removeEventListener("resize",this.layout);window.nes=void 0}}]);
return d}(t.Component);l(58);var ha=function(c){function d(a){Object(A.a)(this,d);a=Object(G.a)(this,Object(H.a)(d).call(this,a));a.recordPageview=function(b){return null};a.state={error:null};return a}Object(I.a)(d,c);Object(C.a)(d,[{key:"render",value:function(){return this.state.error?f.a.createElement("div",{className:"container my-4"},f.a.createElement("div",{className:"row justify-content-center"},f.a.createElement("div",{className:"col-md-8"},"Oops - there has been an error. It has been logged to the console."))):
f.a.createElement(R.a,null,f.a.createElement("div",{className:"App"},f.a.createElement(K.a,{exact:!0,path:"/",component:S}),f.a.createElement(K.a,{exact:!0,path:"/run",component:O}),f.a.createElement(K.a,{exact:!0,path:"/run/:rom",component:O}),f.a.createElement(K.a,{path:"/",render:this.recordPageview})))}},{key:"componentDidCatch",value:function(a,b){this.setState({error:a});N(a,b)}}]);return d}(t.Component);l(61);y&&J.a.config(y).install();J.a.context(function(){Q.a.render(f.a.createElement(ha,
null),document.getElementById("root"))})}},[[34,2,1]]]);